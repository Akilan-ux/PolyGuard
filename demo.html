<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PolyGuard Demo — Registration, Authentication, Proof of Transaction</title>
    <link rel="stylesheet" href="main.css">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        /* Small overrides for demo page */
        .demo-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 24px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.06);
        }

        .demo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 18px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            border-bottom: 1px solid var(--border-gray);
            padding-bottom: 12px;
            margin-bottom: 18px;
        }

        .tab-btn {
            background: transparent;
            padding: 10px 16px;
            border-radius: 8px 8px 0 0;
            border: 1px solid transparent;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .tab-btn[aria-selected="true"] {
            background: var(--white);
            border-color: var(--border-gray);
            border-bottom-color: var(--white);
            color: var(--primary-blue);
            box-shadow: 0 -3px 12px rgba(0,82,204,0.08);
        }

        .tab-panel {
            display: none;
            padding: 18px 6px;
        }

        .tab-panel.active {
            display: block;
        }

        .form-row {
            margin-bottom: 12px;
        }

        .form-row .full {
            width: 100%;
        }

        input[type="text"], input[type="email"], input[type="password"], textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            font-size: 14px;
        }

        /* Mobile compatibility for registration modal */
        #registerModal > div {
            max-width: 420px;
            width: calc(100% - 40px);
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px auto;
        }

        @media (max-width: 480px) {
            #registerModal > div {
                width: calc(100% - 20px);
                padding: 24px 16px;
                margin: 10px auto;
            }
        }

        .result-box {
            padding: 14px;
            border-radius: 8px;
            background: var(--light-gray);
            border: 1px solid var(--border-gray);
            margin-top: 12px;
            font-size: 14px;
        }

        .back-link { color: var(--medium-gray); font-size: 14px; }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="navbar-container container">
            <div class="navbar-brand"><h1>PolyGuard</h1></div>
            <nav class="navbar-menu">
                <a href="main.html" class="nav-link back-link">← Back to Home</a>
            </nav>
        </div>
    </header>

    <main class="demo-container">
        <div class="demo-header">
            <div>
                <h2 style="margin-bottom:6px;">PolyGuard DashBoard</h2>
                <p style="margin:0; color:var(--medium-gray);">Try out</p>
            </div>
        </div>

            <div id="loginContainer" style="max-width:400px; margin:auto;">
                <h2 style="margin-bottom:10px;">PolyGuard Demo Login</h2>
                <p style="color:var(--medium-gray); margin-bottom:20px;">
                    Please login or register to continue.
                </p>
            
                <div style="margin-bottom:12px;">
                    <label>User ID</label>
                    <input id="loginUser" type="text"
                        style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-gray);" />
                </div>
            
                <div style="margin-bottom:20px;">
                    <label>Password</label>
                    <input id="loginPass" type="text" 
                        style="width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-gray);" />
                </div>
            
                <button id="loginBtn" class="btn btn-primary" style="width:100%; margin-bottom:10px;">Login</button>
                <button id="registerBtn" class="btn btn-tier-secondary" style="width:100%;">Register</button>

<!-- Registration Modal -->
<div id="registerModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); z-index:9999; overflow-y:auto;">
  <div style="background:#fff; max-width:420px; margin:60px auto; padding:32px 24px; border-radius:12px; box-shadow:0 8px 32px rgba(0,0,0,0.12); position:relative;">
    <h3 style="margin-bottom:18px;">Register Account</h3>
    <form id="registerForm">
      <div class="form-row">
        <div class="full"><label>User Name</label><input type="text" id="regUser" required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Password</label><input type="password" id="regPass" required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Company UEN No</label><input type="text" id="regUEN" required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Company Name (Legal)</label><input type="text" id="regCompanyName" required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Business Type</label><input type="text" id="regBizType" placeholder="LLC, Sole Proprietor, etc." required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Company Website</label><input type="text" id="regWebsite"></div>
      </div>
      <div class="form-row">
        <div class="full"><label>User Job Position</label><input type="text" id="regJob" required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Phone Number</label><input type="text" id="regPhone" required></div>
      </div>
      <div class="form-row">
        <div class="full"><label>Email</label><input type="email" id="regEmail" required></div>
      </div>
      <div class="form-row">
        <div class="full"><button type="submit" class="btn btn-primary" style="width:100%;">Submit Registration</button></div>
      </div>
      <div id="registerMsg" style="margin-top:10px; font-size:14px; color:var(--medium-gray);"></div>
    </form>
    <button id="closeRegisterModal" style="position:absolute; top:12px; right:16px; background:none; border:none; font-size:18px; color:#888; cursor:pointer;">&times;</button>
  </div>
</div>
            
                <div id="loginMessage" style="margin-top:15px; font-size:14px; color:var(--medium-gray);"></div>
            </div>




    </main>

    <script>

document.getElementById("loginBtn").addEventListener("click", async () => {
    const user = loginUser.value.trim();
    const pass = loginPass.value.trim();

    if (!user || !pass) {
        loginMessage.textContent = "Please enter User ID and Password.";
        loginMessage.style.color = "red";
        return;
    }

    try {
        const res = await fetch("/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                userName: user,
                password: pass
            })
        });

        const data = await res.json();

        if (data.success) {
            // Store token and merchant data
            localStorage.setItem('polyguard_token', data.token);
            localStorage.setItem('polyguard_merchant', JSON.stringify(data.merchant));

            loginMessage.style.color = "green";
            loginMessage.textContent = "Login successful! Redirecting...";

            // Redirect based on admin status
            setTimeout(() => {
                if (data.merchant.is_admin) {
                    window.location.href = '/admin-dashboard.html';
                } else {
                    window.location.href = '/merchant-dashboard.html';
                }
            }, 500);
        } else {
            loginMessage.textContent = data.error || "Login failed";
            loginMessage.style.color = "red";
        }
    } catch (err) {
        loginMessage.textContent = "Error connecting to server";
        loginMessage.style.color = "red";
    }
});    // Registration modal logic
const registerBtn = document.getElementById("registerBtn");
const registerModal = document.getElementById("registerModal");
const closeRegisterModal = document.getElementById("closeRegisterModal");
registerBtn.onclick = () => { registerModal.style.display = "block"; };
closeRegisterModal.onclick = () => { registerModal.style.display = "none"; };
window.onclick = (e) => { if (e.target === registerModal) registerModal.style.display = "none"; };

// Registration form submission
const registerForm = document.getElementById("registerForm");
registerForm.onsubmit = async (e) => {
    e.preventDefault();
    const regUser = document.getElementById("regUser").value.trim();
    const regPass = document.getElementById("regPass").value.trim();
    const regUEN = document.getElementById("regUEN").value.trim();
    const regCompanyName = document.getElementById("regCompanyName").value.trim();
    const regBizType = document.getElementById("regBizType").value.trim();
    const regWebsite = document.getElementById("regWebsite").value.trim();
    const regJob = document.getElementById("regJob").value.trim();
    const regPhone = document.getElementById("regPhone").value.trim();
    const regEmail = document.getElementById("regEmail").value.trim();
    const registerMsg = document.getElementById("registerMsg");

    if (!regUser || !regPass || !regUEN || !regCompanyName || !regBizType || !regJob || !regPhone || !regEmail) {
        registerMsg.textContent = "Please fill all required fields.";
        registerMsg.style.color = "red";
        return;
    }

    // Send registration data to backend
    try {
        const res = await fetch("/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                user_name: regUser,
                password: regPass,
                company_uen: regUEN,
                company_name: regCompanyName,
                business_type: regBizType,
                company_website: regWebsite,
                job_position: regJob,
                phone_number: regPhone,
                email: regEmail
            })
        });
        const data = await res.json();
        if (data.success) {
            registerMsg.textContent = "Registration successful! Please wait for admin approval.";
            registerMsg.style.color = "green";
            setTimeout(() => { 
                registerModal.style.display = "none"; 
                registerForm.reset();
            }, 2000);
        } else {
            registerMsg.textContent = data.error || "Registration failed.";
            registerMsg.style.color = "red";
        }
    } catch (err) {
        registerMsg.textContent = "Error connecting to server.";
        registerMsg.style.color = "red";
    }
};






    </script>
</body>
</html>